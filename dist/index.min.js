!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";var i=n(1),o={},a="http://ow5o14n5d.bkt.clouddn.com/",r=new Date,s="http://ow5o14n5d.bkt.clouddn.com/meta-"+r.getFullYear()+"-"+(r.getMonth()+1)+".json";document.getElementById("totop").addEventListener("click",function(){(0,i.animate)(document.documentElement,"scrollTop",0,1e3,i.easeInOutCubic),(0,i.animate)(document.body,"scrollTop",0,1e3,i.easeInOutCubic)}),(0,i.isMobile)()&&(document.getElementById("close").parentNode.className="",document.getElementById("close").addEventListener("click",function(t){t.target.parentNode.className="hidden"})),(0,i.loadFile)(s,function(t){console.log(t.name+": "+t.description),console.log("Author: "+t.author);for(var e=t.content.length,n=void 0,r=function(e){var n=Math.floor(t.content[e].date/1e4);n<=2012&&(n="~2012"),o[n+=""]?o[n].push(e):o[n]=[e],t.content[e].tags.forEach(function(t){o[t]?o[t].push(e):o[t]=[e]})},s=0;s<e;s++)r(s);n=Object.keys(o);var c={template:'<div id="photos" @click="changeView($event)">        <aside class="loading" v-if="!isHidden">          <div class="spinner">            <div class="bounce1"></div>            <div class="bounce2"></div>            <div class="bounce3"></div>            <p>加载中...</p>          </div>        </aside>        <Column v-for="(items, index) in itemsForColumns" :items="items" :id="index" @load="handleLoad">      </div>',data:function(){return{columns:Math.floor(document.body.clientWidth/266),lastFlag:5*Math.floor(document.body.clientWidth/266)-1,loadedCount:0,isHidden:!1}},props:["factors"],methods:{changeView:function(t){+t.target.parentNode.id&&this.$emit("toinfo",t.target.parentNode.id)},handleScroll:function(t){var e=this;if(!(this.items.length<=this.lastFlag)){for(var n=-1,i=0;i<this.columns;i++){var o=document.getElementById("wall-"+i);o&&o.offsetTop+o.clientHeight-20<t+(window.innerHeight||document.documentElement.clientHeight)&&(n=i)}++n&&(this.lastFlag+=n,setTimeout(function(){e.handleScroll(t)},0))}},handleLoad:function(){this.loadedCount++}},computed:{items:function(){var r=[],s={},c=Array.apply(null,Array(e)).map(function(t,e){return e}),d=void 0;this.factors.forEach(function(t){d=n.filter(function(e){return e.toLowerCase().includes(t.toLowerCase())}).reduce(function(t,e){return t.concat(o[e])},[]),c=(0,i.intersection)(d,c)});for(var l=c.length-1;l>=0;l--)void 0==s[c[l]]&&(s[c[l]]=1,r.push({id:c[l],desc:t.content[c[l]].info,path:""+a+c[l]+"."+t.content[c[l]].type+"-compress"}));return r},itemsForColumns:function(){var t=this,e=Array.apply(null,Array(this.columns)).map(function(){return[]});return this.items.slice(0,this.lastFlag+1).forEach(function(n,i){e[i%t.columns].push(n)}),e}},watch:{items:function(t){var e=this;this.lastFlag=5*Math.floor(document.body.clientWidth/266)-1,this.isHidden=!t.length,setTimeout(function(){e.isHidden=!0},3e3),this.loadedCount=0},loadedCount:function(t){t>=Math.min(this.lastFlag+1,this.items.length)&&(this.isHidden=!0)},isHidden:function(t){t?document.body.className="":(document.body.scrollTop=0,document.body.className="noscroll")}},mounted:function(){var t=this;setTimeout(function(){t.isHidden=!0},3e3),window.addEventListener("scroll",function(e){var n=document.body.scrollTop||document.documentElement.scrollTop,i=document.getElementById("totop");i.className=n?"":"hidden",t.handleScroll(n)}),window.addEventListener("resize",function(e){t.columns=Math.floor(document.body.clientWidth/266),t.lastFlag=Math.max(5*t.columns-1,t.lastFlag)})},components:{Column:{template:'<div class="wall-column" :id="`wall-${id}`">      <figure v-for="item in items" :id="item.id">        <img :src="item.path" @load="onload">        <aside><span>{{item.desc}}</span></aside>      </figure>    </div>',props:["items","id"],methods:{onload:function(){this.$emit("load")}}}}},d={template:'<div id="display">      <aside @click="quit">×</aside>      <figure><img :src="path" title="查看原图" @click="checkFullSize"></figure>      <div id="imginfo">        <p><span class="vertical-center img-intro">{{info}}</span></p>        <div id="imgtags" @click="chooseTag($event)">          <span v-for="tag in tags">{{tag}}</span>        </div>        <div id="imgrelated" class="clearfix" @click="choosePic($event)">          <div>相关的图片：</div>          <img v-for="relate in relates" :src="relate.path" :id="relate.id" :title="relate.title">        </div>      </div>    </div>',props:["pid"],data:function(){return{id:this.pid}},methods:{chooseTag:function(t){this.$emit("revisetag",t.target.innerText)},choosePic:function(t){var e=+t.target.id;e>=0&&(this.id=e)},checkFullSize:function(){window.open(this.path)},quit:function(){this.$emit("revisetag")}},computed:{path:function(){return""+a+this.id+"."+t.content[this.id].type+"-compress"},info:function(){return t.content[this.id].info},tags:function(){return t.content[this.id].tags},relates:function(){for(var e=this.tags.sort(function(t,e){return o[t].length-o[e].length}).filter(function(t){return o[t].length>1}),n=new Set([+this.id]),r=[],s=function(t,i){if(n.size>=8)return"break";o[e[t]].forEach(function(i){n.has(i)||(n.add(i),r.push({id:i,relatedTag:e[t]}))})},c=0,d=e.length;c<d;c++){if("break"===s(c))break}return(r=(0,i.shuffle)(r).slice(0,4)).map(function(e){return{path:""+a+e.id+"."+t.content[e.id].type+"-compress",id:e.id,title:e.relatedTag}})}}};new Vue({data:{filter:"",pid:0,currView:"picwall",index:-1},mounted:function(){var t=this;document.getElementById("navbar").addEventListener("click",function(e){var n=e.target.className,i=+e.target.id;"list-unit"===n?t.addTag(e):~n.indexOf("list-item")&&t.index!==i?t.modifyIndex(i):t.modifyIndex(-1),e.stopPropagation()}),window.addEventListener("click",function(){t.modifyIndex(-1)})},methods:{addPreface:function(){""==this.filter&&(this.filter="preface"),-1==this.factors.indexOf("preface")&&(this.filter+=",preface")},addShot:function(){""==this.filter&&(this.filter="screenshot"),-1==this.factors.indexOf("screenshot")&&(this.filter+=",screenshot")},addTag:function(t){var e=t.target.dataset.tag;""==this.filter&&(this.filter=e),-1==this.factors.indexOf(e)&&(this.filter+=","+e)},toInfo:function(t){t&&(this.pid=t),this.currView="picinfo"},reviseTag:function(t){t?this.filter=t:this.currView="picwall"},modifyIndex:function(t){this.index=t}},computed:{factors:function(){return this.filter.split(",",10).filter(function(t){return""!=t})}},watch:{filter:function(){this.currView="picwall",this.index=-1},currView:function(t){document.body.className="picinfo"===t?"noscroll":""}},components:{picwall:c,picinfo:d}}).$mount("#app")})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loadFile=function(t,e){if("function"!=typeof fetch){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var t=void 0;try{t=JSON.parse(n.responseText)}catch(e){t={},console.warn(e)}e(t)}else console.warn("Error",n.statusText)},n.open("GET",t,!0),n.send()}else fetch(t).then(function(t){return t.json()}).then(function(t){return e(t)})},e.easeInOutCubic=function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},e.animate=function(t,e,n,o,a){if(t&&t[e]&&!(o<100)){var r=t[e],s=n-r,c=null;i(function n(d){null===c&&(c=d);var l=d-c;t[e]=r+a(l/o)*s,l<o&&i(n)})}},e.isMobile=function(){return navigator.userAgent.match(/Android|iPhone|iPod|Opera Mini|webOS|Windows Phone|IEMobile|BlackBerry/i)},e.shuffle=function(t){for(var e=t.length;e>0;){var n=Math.floor(Math.random()*e),i=[t[--e],t[n]];t[n]=i[0],t[e]=i[1]}return t},e.intersection=function(t,e){return t.filter(function(t){return!!~e.indexOf(t)})};var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){var e=+new Date,n=Math.max(0,16-(e-lastTime)),i=window.setTimeout(function(){t(e+n)},n);return lastTime=e+n,i}}]);